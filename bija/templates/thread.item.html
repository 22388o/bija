{% if post['thread_root'] is not none %}
{% set thread_root=post['thread_root'] %}
{% elif post['response_to'] is not none %}
{% set thread_root=post['response_to'] %}
{% else %}
{% set thread_root=post['id'] %}
{% endif %}

{% if post['thread_root'] is none and post['response_to'] is none %}
{% set parent='' %}
{% elif post['response_to'] is not none and post['thread_root'] is none %}
{% set parent=post['response_to'] %}
{% elif post['thread_root'] is not none and post['response_to'] is none %}
{% set parent=post['thread_root'] %}
{% else %}
{% set parent=post['response_to'] %}
{% endif %}

<div class="note-container" data-rel="{{thread_root}}" data-id="{{post['id']}}" data-parent="{{parent}}">
    <div class="is-parent"></div>
    <div class="note-image">
        {% set p=post %}
        {% include 'profile.image.html' %}
    </div>
    <div class="note" data-dt="{{post['created_at']}}">
        <h3>
            <a href="/profile?pk={{post['public_key']}}" class="profile-name">{{post['name'] | ident_string(post['public_key'], post['nip05'], post['nip05_validated']) | safe }}</a>
            <span class="sm dt">{{post['created_at']|dt}} <span class="info" data-id="{{post['id']}}">ðŸ›ˆ</span></span>
        </h3>
        <div class="note-content" data-rel="{{thread_root}}" data-id="{{post['id']}}">
            <pre>{{post['content'] |safe}}{{post['media'] | process_media_attachments | safe}}</pre>
        </div>
        {% include 'note.reply_form.html' %}
    </div>
</div>