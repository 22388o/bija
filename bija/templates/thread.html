<div id="thread-items">
{% for post in notes: %}

    {% if post['thread_root'] is not none %}
    {% set thread_root=post['thread_root'] %}
    {% elif post['response_to'] is not none %}
    {% set thread_root=post['response_to'] %}
    {% else %}
    {% set thread_root=post['id'] %}
    {% endif %}

    {% if post['thread_root'] is none and post['response_to'] is none %}
    {% set parent='' %}
    {% elif post['response_to'] is not none and post['thread_root'] is none %}
    {% set parent=post['response_to'] %}
    {% elif post['thread_root'] is not none and post['response_to'] is none %}
    {% set parent=post['thread_root'] %}
    {% else %}
    {% set parent=post['response_to'] %}
    {% endif %}

    <div class="note-container" data-rel="{{thread_root}}" data-id="{{post['id']}}" data-parent="{{parent}}">
        <div class="is-parent"></div>
        <div class="note-image">
            {% if post['pic'] is not none %}
            <img src="{{post['pic']}}" class="profile-pic" />
            {% else %}
            <img src="/identicon?id={{post['public_key']}}" class="profile-pic" />
            {% endif %}
        </div>
        <div class="note" data-dt="{{post['created_at']}}">
            <h3>
                <a href="/profile?pk={{post['public_key']}}" class="profile-name">{{post['name'] | ident_string(post['public_key'], post['nip05'], post['nip05_validated']) | safe }}</a>
            </h3>
            <pre class="note-content" data-rel="{{thread_root}}" data-id="{{post['id']}}">{{post['content'] |safe}}<p></p></pre>
            <p><span class="reply-n"></span> replies<a href="#" class="reply-link right" data-rel="{{post['id']}}">reply</a></p>
            <form class="reply-form"  data-noteid="{{post['id']}}" >
                <input type="hidden" name="pubkey" value="{{post['public_key']}}">
                <input type="hidden" name="parent_id" value="{{post['id']}}">
                <input type="hidden" name="thread_root" value="{{thread_root}}">
                <textarea name="reply"></textarea>
                <input type="submit" value="post" data-reply-submit="1" data-rel="{{post['id']}}">
            </form>
        </div>
    </div>

{% endfor %}
</div>