<div class="ts" data-ts="{{last}}"></div>
{% for thread in threads: %}
{% if thread['responder_count'] > 0 %}
{% set root_class = 'note-container root' %}
{% else %}
{% set root_class = 'note-container' %}
{% endif %}
{% if thread['self'] is not none %}
{% set post = thread['self'] %}
<div class="{{root_class}}">
    <div class="thread-marker"></div>
    <div class="note-image">
        {% set p=post %}
        {% include 'profile.image.html' %}
    </div>
    <div class="note-outer">
    {% if thread['responder_count'] > 0 %}
    <div class="response-accounts">
        {{ thread['responders'] | responders_string(thread['responder_count']) | safe }}
        {% if thread['self'] is none %}
        on a <a href="/note?id={{thread['id']}}#{{thread['id']}}">thread</a>
        {% endif %}
    </div>
    {% endif %}
    <div class="note" data-dt="{{post['created_at']}}">
        <h3>
            <a href="/profile?pk={{post['public_key']}}" class="profile-name">{{post['name'] | ident_string(post['public_key'], post['nip05'], post['nip05_validated']) | safe }}</a>
            <span class="sm dt">{{post['created_at']|dt}} <span class="info" data-id="{{post['id']}}">ðŸ›ˆ</span></span>
        </h3>
        <div class="note-content" data-id="{{post['id']}}" data-rel="{{post['id']}}">
            <pre>{{post['content'] |safe}}{{post['media'] | process_media_attachments | safe}}</pre>
        </div>
        {% include 'note.reply_form.html' %}
    </div>
    </div>
</div>
{% endif %}
{% if thread['response'] is not none %}
{% set post = thread['response'] %}

{% if thread['self'] is not none %}
{% if post['response_to'] != thread['id'] or post['response_to'] is none and post['thread_root'] != thread['id']  %}
<div class="note-container connector">
    <div class="thread-marker"></div>
    <div class="note-image"></div>
    <a href="/note?id={{thread['id']}}#{{post['id']}}">View thread</a>
</div>
{% endif %}
{% endif %}

<div class="note-container">
    <div class="thread-marker"></div>
    <div class="note-image">
        {% set p=post %}
        {% include 'profile.image.html' %}
    </div>
    <div class="note-outer">
    {% if thread['responder_count'] > 0 and thread['self'] is none %}
    <div class="response-accounts">
        {{ thread['responders'] | responders_string(thread['responder_count']) | safe }}
        {% if thread['self'] is none %}
        on a <a href="/note?id={{thread['id']}}#{{thread['id']}}">thread</a>
        {% endif %}
    </div>
    {% endif %}
    <div class="note" data-dt="{{post['created_at']}}">
        <h3>
            <a href="/profile?pk={{post['public_key']}}" class="profile-name">{{post['name'] | ident_string(post['public_key'], post['nip05'], post['nip05_validated']) | safe }}</a>
            <span class="sm dt">{{post['created_at']|dt}} <span class="info" data-id="{{post['id']}}">ðŸ›ˆ</span></span>
        </h3>
        <div class="note-content" data-id="{{post['id']}}" data-rel="{{thread['id']}}">
            <pre>{{post['content'] |safe}}{{post['media'] | process_media_attachments | safe}}</pre>
        </div>
        {% include 'note.reply_form.html' %}
    </div>
    </div>
</div>
{% endif %}
<hr class="thread-divider" />
{% endfor %}