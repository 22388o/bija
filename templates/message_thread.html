{% extends "base.html" %}

{% block content %}
<div class="messages">
{% for message in messages: %}

{% if message['name'] is not none %}
    {% set name=message.name %}
{% else %}
    {% set name=(message.public_key | truncate(21, False, '...')) %}
{% endif %}

{% if message.is_sender %}
    {% if message.pic is not none %}
        {% set pic=message.pic %}
    {% else %}
        {% set pic="/identicon?id="+message.public_key %}
    {% endif %}
    {% set sender=message.name %}
    {% set class='them' %}
{% else %}
    {% if me.pic is not none %}
        {% set pic=me.pic %}
    {% else %}
        {% set pic="/identicon?id="+me.public_key %}
    {% endif %}
    {% set sender="You" %}
    {% set class='me' %}
{% endif %}

<div class="msg {{class}}">
    <div class="msg-profile-pic"><img src='{{pic}}'></div>
    <div class="msg-profile">
        <div class="speech-bubble">
            <div>{{message.content|decr(message.public_key)}}</div>
        </div>
        <p class="dt">{{message['created_at']|dt}}</p>
    </div>

</div>

{% endfor %}
</div>
<div id="message-poster">
  <form id="new_message_form">
      <textarea name="new_message" id="new_message" placeholder="Say something..."></textarea>
      <input type="hidden" name="new_message_pk" id="new_message_pk" value="{{them}}">
      <input type="button" name="new_message_submit" id="new_message_submit" value="Post">
  </form>
</div>

{% endblock content %}